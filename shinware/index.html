<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShinWare Admin Paneli</title>
    <style>
        body { font-family: Arial; text-align:center; margin-top:50px; }
        input { padding: 5px; margin: 5px; width:200px; }
        button { padding:5px 15px; margin:10px; }
        .hidden { display:none; }
    </style>
</head>
<body>
    <h1>ShinWare Admin Paneli</h1>

    <div id="loginDiv">
        <input type="text" id="adminUser" placeholder="Admin kullanıcı adı">
        <input type="password" id="adminPass" placeholder="Admin şifre">
        <button onclick="adminLogin()">Giriş Yap</button>
        <p id="loginMsg"></p>
    </div>

    <div id="panelDiv" class="hidden">
        <h2>Key Oluştur</h2>
        <input type="text" id="newUser" placeholder="Yeni kullanıcı adı">
        <input type="text" id="newKey" placeholder="Yeni key">
        <button onclick="createKey()">Key Oluştur</button>
        <p id="panelMsg"></p>
    </div>

    <script>
        const ADMIN_USERNAME = "Admin";
        const ADMIN_PASSWORD = "123";

        let data = {};

        async function adminLogin() {
            const user = document.getElementById("adminUser").value.trim();
            const pass = document.getElementById("adminPass").value.trim();
            const msg = document.getElementById("loginMsg");

            if(user === ADMIN_USERNAME && pass === ADMIN_PASSWORD) {
                msg.textContent = "✅ Admin giriş başarılı!";
                document.getElementById("loginDiv").classList.add("hidden");
                document.getElementById("panelDiv").classList.remove("hidden");

                // JSON çek (opsiyonel: listeyi göstermek için)
                try {
                    const response = await fetch("https://plugin-lunex.vercel.app/shinware.json");
                    data = await response.json();
                } catch(err) {
                    console.error("JSON çekilemedi", err);
                    data = { users: {} };
                }

            } else {
                msg.textContent = "❌ Hatalı giriş!";
            }
        }

        async function createKey() {
            const newUser = document.getElementById("newUser").value.trim();
            const newKey = document.getElementById("newKey").value.trim();
            const msg = document.getElementById("panelMsg");

            if(!newUser || !newKey) {
                msg.textContent = "❌ Kullanıcı adı ve key gerekli!";
                return;
            }

            try {
                // Backend endpoint'e POST gönder
                const res = await fetch("/api/add_key", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username: newUser, key: newKey })
                });

                const result = await res.json();
                if(res.ok) {
                    msg.textContent = `✅ ${newUser} için key oluşturuldu: ${newKey}`;
                } else {
                    msg.textContent = `❌ Hata: ${result.error}`;
                }

            } catch(err) {
                console.error(err);
                msg.textContent = "❌ Key siteye kaydedilemedi (backend hatası)";
            }
        }
    </script>
</body>
</html>
